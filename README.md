# Cravour: AI Financial Co-Pilot (Webpack SPA Edition)

A responsive, secure, and AI-powered Single Page Application that provides personalized budgeting, expense reporting, and an AI creative suite for ad generation. This version uses a modern TypeScript and Webpack build process for optimal performance and maintainability, with all sensitive operations securely handled on the backend by Firebase Cloud Functions.

![Build Status](https://img.shields.io/badge/build-passing-brightgreen)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

## Table of Contents
- [Live Demo](#live-demo)
- [Features](#features)
- [Tech Stack](#tech-stack)
- [Project Structure](#project-structure)
- [Setup & Installation](#setup--installation)
- [Local Development](#local-development)
- [Build & Deployment](#build--deployment)
- [Environment Variables](#environment-variables)
- [Architectural Decisions](#architectural-decisions)

## Live Demo
(Replace with your actual URL after deployment to Firebase Hosting)

## Features

- **Authenticated Single Page App:** Secure user registration and login backed by Firebase Authentication. The entire authenticated experience runs within a single, fast-loading `app.html` shell.
- **Secure Backend Proxy for AI:** All AI features (plan generation, ad creatives, financial insights) are powered by the backend, which securely communicates with the Gemini API. No API keys are ever exposed on the frontend.
- **Live AI-Powered Dashboard:** On-demand generation of a full financial report, including spending analysis, financial health scores, and actionable recommendations.
- **AI-Assisted Transactions:** When adding expenses, the AI instantly suggests the correct category based on the transaction description.
- **AI Financial Plan Generation:** Users describe a shopping goal, and the AI generates a detailed budget plan, which is then saved to their Firestore profile.
- **Secure Payments:** Integration with Paystack for wallet funding, with secure backend verification of every transaction to prevent double-crediting.
- **AI Ad Creative Suite:** Users can describe a promotion to instantly receive professional ad headlines, body text, hashtags, and a context-aware, AI-generated image.
- **Modern UI/UX:** Fully responsive design with a sleek dark-themed landing page and a clean, light-themed app interface, built for a seamless mobile-first experience.

## Tech Stack
| Category          | Technology                                                 |
| ----------------- | ---------------------------------------------------------- |
| **Frontend**      | TypeScript, HTML5, CSS3, Webpack 5, Chart.js               |
| **Backend**       | Node.js, Express.js, Firebase Cloud Functions              |
| **Database**      | Cloud Firestore (NoSQL)                                    |
| **AI**            | Google Gemini API (via secure backend proxy)               |
| **Auth**          | Firebase Authentication                                    |
| **Payments**      | Paystack (with secure backend verification)                |
| **Hosting**       | Firebase Hosting                                           |
| **Dev Tools**     | npm Workspaces, nodemon, Webpack Dev Server                |

## Project Structure
The project uses a monorepo structure managed by npm workspaces, separating the frontend (`src/`) from the backend (`functions/`).

```
cravour/
├── dist/                 # Build output (generated by Webpack)
├── functions/            # All Backend Code (Firebase Cloud Function)
│   ├── services/         # (firebaseService, aiService, paymentService, schemas)
│   ├── routes/           # Express route definitions
│   ├── controllers/      # Route logic handlers
│   ├── middleware/       # (auth, error, validation)
│   ├── config/           # Zod schemas
│   ├── index.js          # Main function entry point
│   └── package.json
├── node_modules/
├── public/               # Static assets & HTML templates
│   ├── app.html          # Shell for the authenticated SPA
│   └── index.html        # Shell for the landing page
├── src/                  # All Frontend TypeScript & CSS source code
│   ├── assets/           # CSS and static assets
│   ├── types/            # Custom TypeScript type declarations
│   ├── api.ts            # Centralized backend API client (axios)
│   ├── index.ts          # Entry point for landing page
│   ├── app.ts            # Entry point for the authenticated app
│   └── ...               # Other UI feature modules (router, dashboard, etc.)
├── .env                  # For API keys (must be in .gitignore)
├── .env.example          # Template for required environment variables
├── firebase.json         # Firebase Hosting & Functions configuration
├── package.json          # Root package configuration with workspaces
├── tsconfig.json
└── webpack.config.js
```

## Setup & Installation
Follow these steps to set up the project locally.

**Prerequisites:**
- Node.js (v20 or higher recommended)
- Firebase CLI (`npm install -g firebase-tools`)
- A Firebase project with Authentication, Firestore, and Cloud Functions enabled.
- A Google Cloud project with the Gemini API enabled.
- A Paystack account for payment integration.

1.  **Clone the Repository**
    ```bash
    git clone https://github.com/your-username/cravour.git
    cd cravour
    ```

2.  **Install Dependencies**
    This project uses npm workspaces. Running `npm install` from the root directory will install dependencies for both the frontend and the backend (`functions`) automatically.
    ```bash
    npm install
    ```

3.  **Configure Environment Variables**
    Create a `.env` file in the root of the project by copying the example file:
    ```bash
    cp .env.example .env
    ```
    Fill in your secret keys and configuration in the newly created `.env` file. Refer to the Environment Variables section below for details on each key.


## Local Development
To run the application locally, you need to start both the frontend Webpack server and the backend Firebase Functions server. The `dev` script handles this concurrently.

**Start the Development Servers:**
```bash
npm run dev
```

**Access the Application:**
- The frontend will be available at `http://localhost:8080`.
- The backend API will be running at `http://localhost:3000`. The frontend is automatically proxied to this API.


## Build & Deployment

**Building for Production**
To create an optimized production build of the frontend, run:
```bash
npm run build
```
This will generate a `dist/` directory with minified and hashed assets, ready for deployment.

**Deploying to Firebase**

1.  **Authenticate with Firebase:**
    ```bash
    firebase login
    ```

2.  **Set Backend Environment Variables:**
    Your deployed functions do not read the local `.env` file. You must set them in the Firebase environment. **Ensure your service account key is minified to a single line.**
    ```bash
    firebase functions:config:set \
    gemini.api_key="YOUR_GEMINI_API_KEY" \
    paystack.secret_key="sk_live_xxxxxxxxxx" \
    firebase.service_account_key='YOUR_MINIFIED_JSON_SERVICE_ACCOUNT_KEY'
    ```

3.  **Deploy:**
    The deploy script first builds the frontend and then deploys both Hosting and Functions.
    ```bash
    npm run deploy
    ```

## Environment Variables
Create a `.env` file in the project root with the following variables:

```ini
# --- For Frontend (loaded via Webpack) ---
PAYSTACK_PUBLIC_KEY=pk_test_xxxxxxxxxx
FIREBASE_API_KEY=AIzaSyxxxxxxxxxx
FIREBASE_AUTH_DOMAIN=your-project-id.firebaseapp.com
FIREBASE_PROJECT_ID=your-project-id
FIREBASE_STORAGE_BUCKET=your-project-id.appspot.com
FIREBASE_MESSAGING_SENDER_ID=1234567890
FIREBASE_APP_ID=1:1234567890:web:xxxxxxxxxx

# --- For Backend (Firebase Functions) ---
GEMINI_API_KEY=AIzaSyxxxxxxxxxx_gemini
PAYSTACK_SECRET_KEY=sk_live_xxxxxxxxxx_or_sk_test
# The entire JSON object for your service account key, minified to a single line
FIREBASE_SERVICE_ACCOUNT_KEY='{"type":"service_account",...}'

# --- For Local Dev Server ---
PORT=8080
API_PORT=3000
```

## Architectural Decisions

- **SPA with Backend Proxy:** To ensure maximum security, no sensitive API keys are stored on the frontend. All AI and payment verification calls are proxied through the backend Firebase Function, which authenticates requests using Firebase ID tokens.
- **Atomic Database Operations:** Firestore Transactions and Batched Writes are used in `firebaseService.js` for critical operations like funding a wallet or adding a transaction. This guarantees data consistency by ensuring that related updates either all succeed or all fail together.
- **Client-Side Routing:** The authenticated application (`app.html`) uses hash-based routing (`#dashboard`, `#my-plans`) to provide a fast, seamless user experience without full page reloads.
- **Lazy Initialization:** The client-side router initializes event listeners for each section only when it's first visited, improving initial app startup time. Data is re-fetched on navigation to ensure freshness.
- **Monorepo with npm Workspaces:** The frontend and backend codebases are managed within a single repository, simplifying dependency management and cross-project scripting.
